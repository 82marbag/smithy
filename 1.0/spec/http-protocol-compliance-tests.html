
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>HTTP Protocol Compliance Tests &#8212; Smithy 1.0 documentation</title><link rel="stylesheet" href="../../_static/bootstrap-reboot.css" type="text/css" />
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_tabs/tabs.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.10/segment.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.10/menu.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx_tabs/semantic-ui-2.2.10/tab.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom-tabs.css" type="text/css" />

    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sphinx_tabs/tabs.js"></script>
    <script type="text/javascript" src="../../_static/sphinx_tabs/semantic-ui-2.2.10/tab.min.js"></script>
    <script type="text/javascript" src="../../_static/smithy.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="MQTT Protocol Bindings" href="mqtt.html" />
    <link rel="prev" title="21. JSON AST" href="core/json-ast.html" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="smithy-version" content="1.0">

  </head><body>
    <header>
        <div class="header-flex width-wrapper">
            <div class="site-logo">
                <a href="../../index.html">
                    <span class="logo-icon">üî®Ô∏è</span><span class="logo-text">Smithy</span>
                </a>
                <span class="version-text">1.0</span>
            </div>
            <ul id="page-navigation">
                <li class="site-page first"><a href="../../quickstart.html">Quick Start</a></li>
                <li class="site-page"><a href="index.html">Specifications</a></li>
                <li class="site-page"><a href="../guides/index.html">Guides</a></li>
                <li class="site-page"><a href="https://github.com/awslabs/smithy">Code</a></li>
                <li class="site-search hidden-sm">
                    <form action="../../search.html" method="get">
                        <input type="hidden" name="check_keywords" value="yes" />
                        <input type="hidden" name="area" value="default" />
                        <input class="search-input" autocomplete="off" type="search" name="q" placeholder="Search" />
                    </form>
                </li>
            </ul>
        </div>
    </header>
    
        
        
        <section id="page-container">
            <div class="width-wrapper flex">
                <article id="document-body">
                    
                    <ul class="rel-parents">
                    <li><a href="index.html" accesskey="U">Specifications</a></li>
                    </ul>
                    
                    
  <div class="section" id="http-protocol-compliance-tests">
<span id="id1"></span><h1><a href="#http-protocol-compliance-tests">HTTP Protocol Compliance Tests</a></h1>
<p>Smithy is a protocol-agnostic IDL that tries to abstract the serialization
format of request and response messages sent between a client and server.
Protocol specifications define the serialization format of a protocol, and
protocol compliance tests help to ensure that implementations correctly
implement a protocol specification.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id2">Overview</a><ul>
<li><a class="reference internal" href="#parameter-format" id="id3">Parameter format</a></li>
</ul>
</li>
<li><a class="reference internal" href="#httprequesttests" id="id4">httpRequestTests</a><ul>
<li><a class="reference internal" href="#http-request-example" id="id5">HTTP request example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#httpresponsetests" id="id6">httpResponseTests</a><ul>
<li><a class="reference internal" href="#http-response-example" id="id7">HTTP response example</a></li>
<li><a class="reference internal" href="#http-error-response-example" id="id8">HTTP error response example</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a href="#overview">Overview</a></h2>
<p>This specification defines two traits in the <code class="docutils literal notranslate"><span class="pre">smithy.test</span></code> namespace that
are used to make assertions about client and server protocol implementations.</p>
<dl class="docutils">
<dt><a class="reference internal" href="#httprequesttests-trait"><span class="std std-ref">smithy.test#httpRequestTests</span></a></dt>
<dd>Used to define how an HTTP request is serialized given a specific
protocol, authentication scheme, and set of input parameters.</dd>
<dt><a class="reference internal" href="#httpresponsetests-trait"><span class="std std-ref">smithy.test#httpResponseTests</span></a></dt>
<dd>Used to define how an HTTP response is serialized given a specific
protocol, authentication scheme, and set of output or error parameters.</dd>
</dl>
<p>Protocol implementation developers use these traits to ensure that their
implementation is correct. This can be done through code generation of test
cases or by dynamically loading test cases at runtime. For example, a Java
implementation could generate JUnit test cases to assert that the
expectations defined in a model match the behavior of a generated client
or server.</p>
<div class="section" id="parameter-format">
<h3><a href="#parameter-format">Parameter format</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">params</span></code> property used in both the <code class="docutils literal notranslate"><span class="pre">httpRequestTests</span></code> trait and
<code class="docutils literal notranslate"><span class="pre">httpResponseTests</span></code> trait test cases represents parameters that are used
to serialize HTTP requests and responses. In order to compare implementation
specific results against the expected result of each test case across
different programming languages, parameters are defined in the same format
specified in <a class="reference internal" href="core/traits.html#trait-node-values"><span class="std std-ref">Trait node values</span></a> with the following additional
constraints:</p>
<ul class="simple">
<li>Timestamp values must be converted to a Unix timestamp represented
as an integer.</li>
<li>Client implementations that automatically provide values for members marked
with the <a class="reference internal" href="core/behavior-traits.html#idempotencytoken-trait"><span class="std std-ref">idempotencyToken trait</span></a> MUST use a constant value of
<code class="docutils literal notranslate"><span class="pre">00000000-0000-4000-8000-000000000000</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="httprequesttests">
<span id="httprequesttests-trait"></span><h2><a href="#httprequesttests">httpRequestTests</a></h2>
<dl class="docutils">
<dt>Summary</dt>
<dd>The <code class="docutils literal notranslate"><span class="pre">httpRequestTests</span></code> trait is used to define how an HTTP request is
serialized given a specific protocol, authentication scheme, and set of
input parameters.</dd>
<dt>Trait selector</dt>
<dd><div class="first last highlight-none notranslate"><div class="highlight"><pre><span></span>operation
</pre></div>
</div>
</dd>
<dt>Value type</dt>
<dd><code class="docutils literal notranslate"><span class="pre">list</span></code> of <code class="docutils literal notranslate"><span class="pre">HttpRequestTestCase</span></code> structures</dd>
</dl>
<p>The <code class="docutils literal notranslate"><span class="pre">httpRequestTests</span></code> trait is a list of <code class="docutils literal notranslate"><span class="pre">HttpRequestTestCase</span></code> structures
that support the following members:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="25%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>id</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td><strong>Required</strong>. The identifier of the test case. This identifier can
be used by protocol test implementations to filter out unsupported
test cases by ID, to generate test case names, etc. The provided
<code class="docutils literal notranslate"><span class="pre">id</span></code> MUST match Smithy's <a class="reference internal" href="core/lexical-structure.html#grammar-token-identifier"><code class="xref std std-token docutils literal notranslate"><span class="pre">identifier</span></code></a> ABNF. No two
<code class="docutils literal notranslate"><span class="pre">httpRequestTests</span></code> test cases can share the same ID.</td>
</tr>
<tr class="row-odd"><td>protocol</td>
<td>shape ID</td>
<td><strong>Required</strong>. A shape ID that targets a shape marked with the
<a class="reference internal" href="core/protocol-traits.html#protocoldefinition-trait"><span class="std std-ref">protocolDefinition trait</span></a>. Because Smithy services can support
multiple protocols, each test MUST specify which protocol is under
test.</td>
</tr>
<tr class="row-even"><td>method</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td><strong>Required</strong>. The expected serialized HTTP request method.</td>
</tr>
<tr class="row-odd"><td>uri</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td><strong>Required</strong>. The request-target of the HTTP request, not including
the query string (for example, &quot;/foo/bar&quot;).</td>
</tr>
<tr class="row-even"><td>authScheme</td>
<td>shape ID</td>
<td>A shape ID that specifies the optional authentication scheme to
assume. It's possible that specific authentication schemes might
influence the serialization logic of an HTTP request. The targeted
shape MUST be marked with the <a class="reference internal" href="core/auth-traits.html#authdefinition-trait"><span class="std std-ref">authDefinition trait</span></a> trait.</td>
</tr>
<tr class="row-odd"><td>queryParams</td>
<td><code class="docutils literal notranslate"><span class="pre">list&lt;string&gt;</span></code></td>
<td><p class="first">A list of the expected serialized query string parameters.</p>
<p>Each element in the list is a query string key value pair
that starts with the query string parameter name optionally
followed by &quot;=&quot;, optionally followed by the query string
parameter value. For example, &quot;foo=bar&quot;, &quot;foo=&quot;, and &quot;foo&quot;
are all valid values.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This kind of list is used instead of a map so that query string
parameter values for lists can be represented using repeated
key-value pairs.</p>
</div>
<p>The query string parameter name and the value MUST appear in the
format in which it is expected to be sent over the wire; if a key or
value needs to be percent-encoded, then it MUST appear
percent-encoded in this list.</p>
<p>A serialized HTTP request is not in compliance with the protocol
if any query string parameter defined in <code class="docutils literal notranslate"><span class="pre">queryParams</span></code> is not
defined in the request or if the value of a query string parameter
in the request differs from the expected value.</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">queryParams</span></code> applies no constraints on additional query parameters.</p>
</td>
</tr>
<tr class="row-even"><td>forbidQueryParams</td>
<td><code class="docutils literal notranslate"><span class="pre">list&lt;string&gt;</span></code></td>
<td><p class="first">A list of query string parameter names that must not appear in the
serialized HTTP request.</p>
<p class="last">Each value MUST appear in the format in which it is sent over the
wire; if a key needs to be percent-encoded, then it MUST appear
percent-encoded in this list.</p>
</td>
</tr>
<tr class="row-odd"><td>requireQueryParams</td>
<td><code class="docutils literal notranslate"><span class="pre">list&lt;string&gt;</span></code></td>
<td><p class="first">A list of query string parameter names that MUST appear in the
serialized request URI, but no assertion is made on the value.</p>
<p class="last">Each value MUST appear in the format in which it is sent over the
wire; if a key needs to be percent-encoded, then it MUST appear
percent-encoded in this list.</p>
</td>
</tr>
<tr class="row-even"><td>headers</td>
<td><code class="docutils literal notranslate"><span class="pre">map&lt;string,</span> <span class="pre">string&gt;</span></code></td>
<td><p class="first">A map of expected HTTP headers. Each key represents a header field
name and each value represents the expected header value. An HTTP
request is not in compliance with the protocol if any listed header
is missing from the serialized request or if the expected header
value differs from the serialized request value.</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">headers</span></code> applies no constraints on additional headers.</p>
</td>
</tr>
<tr class="row-odd"><td>forbidHeaders</td>
<td>[<code class="docutils literal notranslate"><span class="pre">string</span></code>]</td>
<td>A list of header field names that must not appear in the serialized
HTTP request.</td>
</tr>
<tr class="row-even"><td>requireHeaders</td>
<td>[<code class="docutils literal notranslate"><span class="pre">string</span></code>]</td>
<td>A list of header field names that must appear in the serialized
HTTP message, but no assertion is made on the value. Headers listed
in <code class="docutils literal notranslate"><span class="pre">headers</span></code> do not need to appear in this list.</td>
</tr>
<tr class="row-odd"><td>body</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td>The expected HTTP message body. If no request body is defined,
then no assertions are made about the body of the message.</td>
</tr>
<tr class="row-even"><td>bodyMediaType</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td>The media type of the <code class="docutils literal notranslate"><span class="pre">body</span></code>. This is used to help test runners
to parse and validate the expected data against generated data.
Binary media type formats require that the contents of <code class="docutils literal notranslate"><span class="pre">body</span></code> are
base64 encoded.</td>
</tr>
<tr class="row-odd"><td>params</td>
<td><code class="docutils literal notranslate"><span class="pre">document</span></code></td>
<td>Defines the input parameters used to generate the HTTP request. These
parameters MUST be compatible with the input of the operation.</td>
</tr>
<tr class="row-even"><td>vendorParams</td>
<td><code class="docutils literal notranslate"><span class="pre">document</span></code></td>
<td>Defines vendor-specific parameters that are used to influence the
request. For example, some vendors might utilize environment
variables, configuration files on disk, or other means to influence
the serialization formats used by clients or servers.</td>
</tr>
<tr class="row-odd"><td>documentation</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td>A description of the test and what is being asserted defined in
<a class="reference external" href="https://spec.commonmark.org/">CommonMark</a>.</td>
</tr>
</tbody>
</table>
<div class="section" id="http-request-example">
<h3><a href="#http-request-example">HTTP request example</a></h3>
<p>The following example defines a protocol compliance test for a JSON protocol
that uses <a class="reference internal" href="core/http-traits.html#http-traits"><span class="std std-ref">HTTP binding traits</span></a>.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U21pdGh5 docutils container">
<div class="docutils container">
Smithy</div>
</div>
<div class="item sphinx-data-tab-SlNPTg== docutils container">
<div class="docutils container">
JSON</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U21pdGh5 active docutils container">
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">namespace</span><span class="nc"> smithy.example</span>

<span class="kd">use</span><span class="nc"> smithy.test#httpRequestTests</span>

<span class="nd">@http</span>(<span class="nl">method:</span> <span class="s2">&quot;POST&quot;</span>, <span class="nl">uri:</span> <span class="s2">&quot;/&quot;</span>)
<span class="nd">@httpRequestTests</span>([
    {
        <span class="nl">id:</span> <span class="s2">&quot;say_hello&quot;</span>,
        <span class="nl">protocol:</span> <span class="vc">exampleProtocol</span>,
        <span class="nl">params:</span> {
            <span class="s2">&quot;greeting&quot;</span>: <span class="s2">&quot;Hi&quot;</span>,
            <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;Teddy&quot;</span>,
            <span class="s2">&quot;query&quot;</span>: <span class="s2">&quot;Hello there&quot;</span>
        },
        <span class="nl">method:</span> <span class="s2">&quot;POST&quot;</span>,
        <span class="nl">uri:</span> <span class="s2">&quot;/&quot;</span>,
        <span class="nl">queryParams:</span> [
            <span class="s2">&quot;Hi=Hello%20there&quot;</span>
        ],
        <span class="nl">headers:</span> {
            <span class="s2">&quot;X-Greeting&quot;</span>: <span class="s2">&quot;Hi&quot;</span>,
        },
        <span class="nl">body:</span> <span class="s2">&quot;{\&quot;name\&quot;: \&quot;Teddy\&quot;}&quot;</span>,
        <span class="nl">bodyMediaType:</span> <span class="s2">&quot;application/json&quot;</span>
    }
])
<span class="kd">operation</span><span class="nc"> SayHello</span> {
    <span class="nl">input:</span> <span class="vc">SayHelloInput</span>
}

<span class="kd">structure</span><span class="nc"> SayHelloInput</span> {
    <span class="nd">@httpHeader</span>(<span class="s2">&quot;X-Greeting&quot;</span>)
    <span class="nl">greeting:</span> <span class="vc">String</span>,

    <span class="nd">@httpQuery</span>(<span class="s2">&quot;Hi&quot;</span>)
    <span class="nl">query:</span> <span class="vc">String</span>,

    <span class="nl">name:</span> <span class="vc">String</span>
}
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SlNPTg== docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;smithy&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;shapes&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;smithy.example#SayHello&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;input&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.example#SayHelloInput&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;traits&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;smithy.api#http&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="mi">200</span>
                <span class="p">},</span>
                <span class="nt">&quot;smithy.test#httpRequestTests&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;say_hello&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.example#exampleProtocol&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;headers&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;X-Greeting&quot;</span><span class="p">:</span> <span class="s2">&quot;Hi&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;queryParams&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="s2">&quot;Hi=Hello%20there&quot;</span>
                        <span class="p">],</span>
                        <span class="nt">&quot;body&quot;</span><span class="p">:</span> <span class="s2">&quot;{\&quot;name\&quot;: \&quot;Teddy\&quot;}&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;bodyMediaType&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span>
                        <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;greeting&quot;</span><span class="p">:</span> <span class="s2">&quot;Hi&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Teddy&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;query&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello there&quot;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;smithy.example#SayHelloInput&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
            <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;greeting&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.api#String&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;traits&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;smithy.api#httpHeader&quot;</span><span class="p">:</span> <span class="s2">&quot;X-Greeting&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.api#String&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="httpresponsetests">
<span id="httpresponsetests-trait"></span><h2><a href="#httpresponsetests">httpResponseTests</a></h2>
<dl class="docutils">
<dt>Summary</dt>
<dd>The <code class="docutils literal notranslate"><span class="pre">httpResponseTests</span></code> trait is used to define how an HTTP response
is serialized given a specific protocol, authentication scheme, and set
of output or error parameters.</dd>
<dt>Trait selector</dt>
<dd><div class="first last highlight-none notranslate"><div class="highlight"><pre><span></span>:test(operation, structure[trait|error])
</pre></div>
</div>
</dd>
<dt>Value type</dt>
<dd><code class="docutils literal notranslate"><span class="pre">list</span></code> of <code class="docutils literal notranslate"><span class="pre">HttpResponseTestCase</span></code> structures</dd>
</dl>
<p>The <code class="docutils literal notranslate"><span class="pre">httpResponseTests</span></code> trait is a list of <code class="docutils literal notranslate"><span class="pre">HttpResponseTestCase</span></code>
structures that support the following members:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="10%" />
<col width="25%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>id</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td><strong>Required</strong>. The identifier of the test case. This identifier can
be used by protocol test implementations to filter out unsupported
test cases by ID, to generate test case names, etc. The provided
<code class="docutils literal notranslate"><span class="pre">id</span></code> MUST match Smithy's <a class="reference internal" href="core/lexical-structure.html#grammar-token-identifier"><code class="xref std std-token docutils literal notranslate"><span class="pre">identifier</span></code></a> ABNF. No two
<code class="docutils literal notranslate"><span class="pre">httpResponseTests</span></code> test cases can share the same ID.</td>
</tr>
<tr class="row-odd"><td>protocol</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td><strong>Required</strong>. A shape ID that targets a shape marked with the
<a class="reference internal" href="core/protocol-traits.html#protocoldefinition-trait"><span class="std std-ref">protocolDefinition trait</span></a> trait. Because Smithy services can
support multiple protocols, each test MUST specify which protocol is
under test.</td>
</tr>
<tr class="row-even"><td>code</td>
<td><code class="docutils literal notranslate"><span class="pre">integer</span></code></td>
<td><strong>Required</strong>. The expected HTTP response status code.</td>
</tr>
<tr class="row-odd"><td>authScheme</td>
<td>shape ID</td>
<td>A shape ID that specifies the optional authentication scheme to
assume. It's possible that specific authentication schemes might
influence the serialization logic of an HTTP response. The targeted
shape MUST be marked with the <a class="reference internal" href="core/auth-traits.html#authdefinition-trait"><span class="std std-ref">authDefinition trait</span></a> trait.</td>
</tr>
<tr class="row-even"><td>headers</td>
<td><code class="docutils literal notranslate"><span class="pre">map&lt;string,</span> <span class="pre">string&gt;</span></code></td>
<td><p class="first">A map of expected HTTP headers. Each key represents a header field
name and each value represents the expected header value. An HTTP
response is not in compliance with the protocol if any listed header
is missing from the serialized response or if the expected header
value differs from the serialized response value.</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">headers</span></code> applies no constraints on additional headers.</p>
</td>
</tr>
<tr class="row-odd"><td>forbidHeaders</td>
<td><code class="docutils literal notranslate"><span class="pre">list&lt;string&gt;</span></code></td>
<td>A list of header field names that must not appear in the serialized
HTTP response.</td>
</tr>
<tr class="row-even"><td>requireHeaders</td>
<td><code class="docutils literal notranslate"><span class="pre">list&lt;string&gt;</span></code></td>
<td>A list of header field names that must appear in the serialized
HTTP response, but no assertion is made on the value. Headers listed
in <code class="docutils literal notranslate"><span class="pre">headers</span></code> do not need to appear in this list.</td>
</tr>
<tr class="row-odd"><td>body</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td>The expected HTTP message body. If no response body is defined,
then no assertions are made about the body of the message.</td>
</tr>
<tr class="row-even"><td>bodyMediaType</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td>The media type of the <code class="docutils literal notranslate"><span class="pre">body</span></code>. This is used to help test runners
to parse and validate the expected data against generated data.
Binary media type formats require that the contents of <code class="docutils literal notranslate"><span class="pre">body</span></code> are
base64 encoded.</td>
</tr>
<tr class="row-odd"><td>params</td>
<td><code class="docutils literal notranslate"><span class="pre">document</span></code></td>
<td>Defines the output or error parameters used to generate the HTTP
response. These parameters MUST be compatible with the targeted
operation's output or the targeted error structure.</td>
</tr>
<tr class="row-even"><td>vendorParams</td>
<td><code class="docutils literal notranslate"><span class="pre">document</span></code></td>
<td>Defines vendor-specific parameters that are used to influence the
response. For example, some vendors might utilize environment
variables, configuration files on disk, or other means to influence
the serialization formats used by clients or servers.</td>
</tr>
<tr class="row-odd"><td>documentation</td>
<td><code class="docutils literal notranslate"><span class="pre">string</span></code></td>
<td>A description of the test and what is being asserted defined in
<a class="reference external" href="https://spec.commonmark.org/">CommonMark</a>.</td>
</tr>
</tbody>
</table>
<div class="section" id="http-response-example">
<h3><a href="#http-response-example">HTTP response example</a></h3>
<p>The following example defines a protocol compliance test for a JSON protocol
that uses <a class="reference internal" href="core/http-traits.html#http-traits"><span class="std std-ref">HTTP binding traits</span></a>.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U21pdGh5 docutils container">
<div class="docutils container">
Smithy</div>
</div>
<div class="item sphinx-data-tab-SlNPTg== docutils container">
<div class="docutils container">
JSON</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U21pdGh5 active docutils container">
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">namespace</span><span class="nc"> smithy.example</span>

<span class="kd">use</span><span class="nc"> smithy.test#httpResponseTests</span>

<span class="nd">@http</span>(<span class="nl">method:</span> <span class="s2">&quot;POST&quot;</span>, <span class="nl">uri:</span> <span class="s2">&quot;/&quot;</span>)
<span class="nd">@httpResponseTests</span>([
    {
        <span class="nl">id:</span> <span class="s2">&quot;say_goodbye&quot;</span>,
        <span class="nl">protocol:</span> <span class="vc">exampleProtocol</span>,
        <span class="nl">params:</span> {<span class="nl">farewell:</span> <span class="s2">&quot;Bye&quot;</span>},
        <span class="nl">code:</span> <span class="m">200</span>,
        <span class="nl">headers:</span> {
            <span class="s2">&quot;X-Farewell&quot;</span>: <span class="s2">&quot;Bye&quot;</span>,
            <span class="s2">&quot;Content-Length&quot;</span>: <span class="s2">&quot;0&quot;</span>
        }
    }
])
<span class="kd">operation</span><span class="nc"> SayGoodbye</span> {
    <span class="nl">output:</span> <span class="vc">SayGoodbyeOutput</span>
}

<span class="kd">structure</span><span class="nc"> SayGoodbyeOutput</span> {
    <span class="nd">@httpHeader</span>(<span class="s2">&quot;X-Farewell&quot;</span>)
    <span class="nl">farewell:</span> <span class="vc">String</span>,
}
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SlNPTg== docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;smithy&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;shapes&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;smithy.example#SayGoodbye&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
            <span class="nt">&quot;output&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.example#SayGoodbyeOutput&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;traits&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;smithy.api#http&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="mi">200</span>
                <span class="p">},</span>
                <span class="nt">&quot;smithy.test#httpResponseTests&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;say_goodbye&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.example#exampleProtocol&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;headers&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;Content-Length&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;X-Farewell&quot;</span><span class="p">:</span> <span class="s2">&quot;Bye&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;farewell&quot;</span><span class="p">:</span> <span class="s2">&quot;Bye&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="mi">200</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="nt">&quot;smithy.example#SayGoodbyeOutput&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
            <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;farewell&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.api#String&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;traits&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;smithy.api#httpHeader&quot;</span><span class="p">:</span> <span class="s2">&quot;X-Farewell&quot;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="http-error-response-example">
<h3><a href="#http-error-response-example">HTTP error response example</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">httpResponseTests</span></code> trait can be applied to error structures to define
how an error HTTP response is serialized. Client protocol compliance test
implementations SHOULD ensure that each error with the <code class="docutils literal notranslate"><span class="pre">httpResponseTests</span></code>
trait associated with an operation can be properly deserialized.</p>
<p>The following example defines a protocol compliance test for a JSON protocol
that uses <a class="reference internal" href="core/http-traits.html#http-traits"><span class="std std-ref">HTTP binding traits</span></a>.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U21pdGh5 docutils container">
<div class="docutils container">
Smithy</div>
</div>
<div class="item sphinx-data-tab-SlNPTg== docutils container">
<div class="docutils container">
JSON</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-U21pdGh5 active docutils container">
<div class="highlight-smithy notranslate"><div class="highlight"><pre><span></span><span class="kd">namespace</span><span class="nc"> smithy.example</span>

<span class="kd">use</span><span class="nc"> smithy.test#httpResponseTests</span>

<span class="nd">@error</span>(<span class="s2">&quot;client&quot;</span>)
<span class="nd">@httpError</span>(<span class="m">400</span>)
<span class="nd">@httpResponseTests</span>([
    {
        <span class="nl">id:</span> <span class="s2">&quot;invalid_greeting&quot;</span>,
        <span class="nl">protocol:</span> <span class="vc">exampleProtocol</span>,
        <span class="nl">params:</span> {<span class="nl">foo:</span> <span class="s2">&quot;baz&quot;</span>, <span class="nl">message:</span> <span class="s2">&quot;Hi&quot;</span>},
        <span class="nl">code:</span> <span class="m">400</span>,
        <span class="nl">headers:</span> {<span class="s2">&quot;X-Foo&quot;</span>: <span class="s2">&quot;baz&quot;</span>},
        <span class="nl">body:</span> <span class="s2">&quot;{\&quot;message\&quot;: \&quot;Hi\&quot;}&quot;</span>,
        <span class="nl">bodyMediaType:</span> <span class="s2">&quot;application/json&quot;</span>,
    }
])
<span class="kd">structure</span><span class="nc"> InvalidGreeting</span> {
    <span class="nd">@httpHeader</span>(<span class="s2">&quot;X-Foo&quot;</span>)
    <span class="nl">foo:</span> <span class="vc">String</span>,

    <span class="nl">message:</span> <span class="vc">String</span>,
}
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment code-tab sphinx-data-tab-SlNPTg== docutils container">
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;smithy&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;shapes&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;smithy.example#InvalidGreeting&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
            <span class="nt">&quot;members&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;foo&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.api#String&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;traits&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;smithy.api#httpHeader&quot;</span><span class="p">:</span> <span class="s2">&quot;X-Foo&quot;</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.api#String&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nt">&quot;traits&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;smithy.api#error&quot;</span><span class="p">:</span> <span class="s2">&quot;client&quot;</span><span class="p">,</span>
                <span class="nt">&quot;smithy.api#httpError&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
                <span class="nt">&quot;smithy.test#httpResponseTests&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;invalid_greeting&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.example#exampleProtocol&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;body&quot;</span><span class="p">:</span> <span class="s2">&quot;{\&quot;message\&quot;: \&quot;Hi\&quot;}&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;bodyMediaType&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;headers&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;X-Foo&quot;</span><span class="p">:</span> <span class="s2">&quot;baz&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;baz&quot;</span><span class="p">,</span>
                            <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Hi&quot;</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="mi">400</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>


                    
                    <section class="relations">
                        
                        <a href="core/json-ast.html" title="previous chapter" class="previous-page clearfix hidden-xs">‚Üê 21. JSON AST</a>
                        
                        <a href="mqtt.html" title="next chapter" class="next-page clearfix">MQTT Protocol Bindings ‚Üí</a>
                    </section>
                    
                </article><aside id="right-column" class="side-column hidden-sm">
                    <div class="column-body">
                        <section class="sidebar">
                            
                            <section class="next-previous">
                                
                                <a href="core/json-ast.html" title="previous chapter" class="previous-page clearfix hidden-xs">‚Üê Prev</a>
                                
                                <a href="mqtt.html" title="next chapter" class="next-page clearfix">Next ‚Üí</a>
                            </section>
                            
                            <ul>
<li><a class="reference internal" href="#">HTTP Protocol Compliance Tests</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#parameter-format">Parameter format</a></li>
</ul>
</li>
<li><a class="reference internal" href="#httprequesttests">httpRequestTests</a><ul>
<li><a class="reference internal" href="#http-request-example">HTTP request example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#httpresponsetests">httpResponseTests</a><ul>
<li><a class="reference internal" href="#http-response-example">HTTP response example</a></li>
<li><a class="reference internal" href="#http-error-response-example">HTTP error response example</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                        </section>
                    </div>
                </aside></div>
        </section>
        
    
<footer id="footer">
    <div class="width-wrapper">
        <div class="copyright">
            <p>¬©2020, Amazon Web Services, Inc or its affiliates. All rights reserved.</p>
        </div>
    </div>
</footer>
  </body>
</html>