
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="noindex">
    <title>Converting Smithy to OpenAPI &#8212; Smithy 0.5.0 documentation</title><link rel="stylesheet" href="../_static/bootstrap-reboot.css" type="text/css" />

    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom-tabs.css" type="text/css" />


    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript">
        function _scroll(subjectId) {
            var subjectElement = $(subjectId);
            var actualSubjectHeight = subjectElement.height();
            var startingPosition = subjectElement[0].getBoundingClientRect().top;
            return function() {
                var availableHeight = $(window).height() - startingPosition;
                // Subtract the scroll position to account for sticky movement.
                availableHeight += Math.min($(window).scrollTop(), 40);
                var cappedHeight = Math.min(actualSubjectHeight, availableHeight);
                if (subjectElement.css("height") !== cappedHeight) {
                    subjectElement.css("height", cappedHeight);
                }
            };
        }

        // Scroll and resize the the columns when scrolled.
        $(function() {
            var rightScroll = _scroll("#right-column > .column-body");
            var scrollFn = function() {
                rightScroll.call(this, arguments);
            };
            scrollFn();
            $(window).scroll(scrollFn);
            $(window).resize(scrollFn);
        });

        // Scroll spy to change highlighted navigation element.
        $(function() {
            var section = document.querySelectorAll(".section");
            var sections = {};
            var i = 0;
            Array.prototype.forEach.call(section, function(e) {
                sections[e.id] = e.offsetTop;
            });
            var scrollSpy = function() {
                var scrollPosition = document.documentElement.scrollTop || document.body.scrollTop;
                for (i in sections) {
                    if (sections[i] <= scrollPosition) {
                        $('#right-column .current').removeClass('current');
                        $("#right-column a[href='#" + i + "']").addClass('current');
                    }
                }
            };
            $(window).scroll(scrollSpy);
            scrollSpy();
        });
    </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Style Guide" href="style-guide.html" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  </head><body>
    <header>
        <div class="header-flex width-wrapper">
            <div class="site-logo">
                <a href="../index.html">
                    <span class="logo-icon">⚒️</span><span class="logo-text">Smithy</span><span class="beta-text">beta</span>
                </a>
            </div>
            <ul id="page-navigation">
                <li class="site-page first"><a href="../quickstart.html">Quick Start</a></li>
                <li class="site-page"><a href="../spec/index.html">Specifications</a></li>
                <li class="site-page"><a href="index.html">Guides</a></li>
                <li class="site-page"><a href="https://github.com/awslabs/smithy">Code</a></li>
                <li class="site-search hidden-sm">
                    <form action="../search.html" method="get">
                        <input type="hidden" name="check_keywords" value="yes" />
                        <input type="hidden" name="area" value="default" />
                        <input class="search-input" autocomplete="off" type="search" name="q" placeholder="Search" />
                    </form>
                </li>
            </ul>
        </div>
    </header>

    <div style="margin: 1em; padding: 1em; background: #f8d7da; text-align: center;">
        You are viewing an old version of the documentation.
    </div>


        <section id="page-container">
            <div class="width-wrapper flex">
                <article id="document-body">

  <div class="section" id="converting-smithy-to-openapi">
<h1>Converting Smithy to OpenAPI<a class="headerlink" href="#converting-smithy-to-openapi" title="Permalink to this headline">¶</a></h1>
<p>This guide describes how Smithy models can be converted to <a class="reference external" href="https://github.com/OAI/OpenAPI-Specification">OpenAPI</a>
specifications.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id3">Introduction</a></li>
<li><a class="reference internal" href="#differences-between-smithy-and-openapi" id="id4">Differences between Smithy and OpenAPI</a><ul>
<li><a class="reference internal" href="#unsupported-features" id="id5">Unsupported features</a></li>
</ul>
</li>
<li><a class="reference internal" href="#converting-to-openapi-with-smithy-build" id="id6">Converting to OpenAPI with smithy-build</a><ul>
<li><a class="reference internal" href="#openapi-configuration-settings" id="id7">OpenAPI configuration settings</a></li>
<li><a class="reference internal" href="#json-schema-configuration-settings" id="id8">JSON schema configuration settings</a></li>
<li><a class="reference internal" href="#amazon-api-gateway-extensions" id="id9">Amazon API Gateway extensions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#converting-to-openapi-with-code" id="id10">Converting to OpenAPI with code</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>OpenAPI is a standard for describing REST APIs. While Smithy has it's own
interface definition language that's completely independent of OpenAPI,
there are many use cases for authoring API models in Smithy and converting
them to OpenAPI using both ad-hoc and automated workflows. For example,
integration with <a class="reference external" href="https://aws.amazon.com/api-gateway/">Amazon API Gateway</a>, access to OpenAPI tools like
SwaggerUI, or access to OpenAPI client and server code generators when
Smithy generators are not available.</p>
<p>Smithy models can be converted to OpenAPI through smithy-build using the
<code class="docutils literal notranslate"><span class="pre">openapi</span></code> plugin or through code using the
<a class="reference external" href="https://search.maven.org/search?q=g:software.amazon.smithy%20and%20a:smithy-openapi">software.amazon.smithy:smithy-openapi</a> Java package.</p>
</div>
<div class="section" id="differences-between-smithy-and-openapi">
<h2>Differences between Smithy and OpenAPI<a class="headerlink" href="#differences-between-smithy-and-openapi" title="Permalink to this headline">¶</a></h2>
<p>Smithy and OpenAPI take very different approaches to modeling APIs. Smithy is
<em>protocol agnostic</em>, which means it focuses on the interfaces and abstractions
that are provided to end-users rather than how the data is sent over the wire.
While Smithy can define RESTful APIs, OpenAPI <em>specializes</em> in defining <em>only</em>
RESTful APIs. Both approaches have their own strengths and weaknesses. For
example, while Smithy can define a much broader set of functionality and
services, it requires abstractions that have their own underlying complexity.
OpenAPI is more permissive in the kinds of services it can describe, making it
easier to adapt to existing web services, but at the same time making it possible
to author APIs that provide a poor customer experience when using clients in
strongly-typed languages.</p>
<div class="section" id="unsupported-features">
<h3>Unsupported features<a class="headerlink" href="#unsupported-features" title="Permalink to this headline">¶</a></h3>
<p>Converting a Smithy model to OpenAPI results in a trimmed-down, lossy
representation of a model for a specific HTTP protocol. Various features in
a Smithy model are not currently supported in the OpenAPI conversion:</p>
<ul class="simple">
<li><a class="reference internal" href="../spec/http.html#httpprefixheaders-trait"><span class="std std-ref">HTTP prefix headers</span></a>: &quot;Prefix headers&quot;
are used in Smithy to bind all headers under a common prefix into a
single property of the input or output of an API operation. This can
be used for things like Amazon S3's <a class="reference external" href="https://docs.aws.amazon.com/AmazonS3/latest/API/RESTObjectPUT.html">x-amz-meta-* headers</a>. OpenAPI
does not currently support this kind of header.</li>
<li><a class="reference internal" href="../spec/http.html#greedy-labels"><span class="std std-ref">Greedy labels</span></a>: Greedy labels are used in HTTP URIs to act as a
placeholder for multiple segments of a URI (for example,
<code class="docutils literal notranslate"><span class="pre">/foo/{baz+}/bar</span></code>). Some OpenAPI vendors/tooling support greedy labels
(for example, Amazon API Gateway) while other do not. The converter will
pass greedy labels through into the OpenAPI document by default, but they
can be forbidden through the <code class="docutils literal notranslate"><span class="pre">openapi.forbidGreedyLabels</span></code> flag.</li>
<li><a class="reference internal" href="../spec/event-streams.html#event-streams"><span class="std std-ref">Event streams</span></a>: Event streams are a way of sending
many different messages over a stream. This is not currently implemented
in the converter (see <a class="reference external" href="https://github.com/awslabs/smithy/issues/80">#80</a>).</li>
<li>Streaming: Smithy allows blob and string shapes to be marked as
streaming, meaning that their contents should not be loaded into
memory by clients or servers. This is not currently something supported
as a built-in feature of OpenAPI (we could potentially add an extension
to mark a specific type as streaming).</li>
<li><a class="reference internal" href="../spec/core.html#trait-definition"><span class="std std-ref">Custom traits</span></a>: Custom traits defined in a Smithy
model are not converted and added to the OpenAPI specification. Copying
Smithy traits into OpenAPI as extensions requires the use of a custom
<code class="docutils literal notranslate"><span class="pre">software.amazon.smithy.openapi.fromsmithy.OpenApiExtension</span></code>.</li>
<li>Non-RESTful routing: HTTP routing schemes that aren't based on
methods and unique URIs are not supported in OpenAPI (for example,
routing to operations based on a specific header or query string
parameter).</li>
<li>Non-HTTP protocols: Protocols that do not send requests over HTTP are
not supported with OpenAPI (for example, an MQTT-based protocol modeled
with Smithy would need to also support an HTTP-based protocol to be
converted to OpenAPI).</li>
<li>Resources: Smithy resource metadata is not carried over into the OpenAPI
specification.</li>
</ul>
</div>
</div>
<div class="section" id="converting-to-openapi-with-smithy-build">
<h2>Converting to OpenAPI with smithy-build<a class="headerlink" href="#converting-to-openapi-with-smithy-build" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">openapi</span></code> plugin contained in the <code class="docutils literal notranslate"><span class="pre">software.amazon.smithy:smithy-openapi</span></code>
package can be used with smithy-build and the <a class="reference external" href="https://github.com/awslabs/smithy-gradle-plugin">Smithy Gradle plugin</a> to build
OpenAPI specifications from Smithy models.</p>
<p>The following example shows how to configure Gradle to build an OpenAPI
specification from a Smithy model using a buildscript dependency:</p>
<div class="literal-block-wrapper docutils container" id="smithy-build-gradle">
<div class="code-block-caption"><span class="caption-text">build.gradle.kts</span><a class="headerlink" href="#smithy-build-gradle" title="Permalink to this code">¶</a></div>
<div class="highlight-kotlin notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span> <span class="p">{</span>
    <span class="n">java</span>
    <span class="n">id</span><span class="p">(</span><span class="s">&quot;software.amazon.smithy&quot;</span><span class="p">).</span><span class="n">version</span><span class="p">(</span><span class="s">&quot;0.4.3&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">buildscript</span> <span class="p">{</span>
    <span class="n">dependencies</span> <span class="p">{</span>
        <span class="n">classpath</span><span class="p">(</span><span class="s">&quot;software.amazon.smithy:smithy-openapi:0.9.7&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>The Smithy Gradle plugin relies on a <code class="docutils literal notranslate"><span class="pre">smithy-build.json</span></code> file found at the
root of a project to define the actual process of building the OpenAPI
specification. The following example defines a <code class="docutils literal notranslate"><span class="pre">smithy-build.json</span></code> file
that builds an OpenAPI specification from a service for the
<code class="docutils literal notranslate"><span class="pre">smithy.example#Weather</span></code> service using the <code class="docutils literal notranslate"><span class="pre">aws.rest-json-1.1</span></code> protocol:</p>
<div class="literal-block-wrapper docutils container" id="open-api-smithy-build-json">
<div class="code-block-caption"><span class="caption-text">smithy-build.json</span><a class="headerlink" href="#open-api-smithy-build-json" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;plugins&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;openapi&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.example#Weather&quot;</span><span class="p">,</span>
            <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;aws.rest-json-1.1&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">A buildscript dependency on &quot;software.amazon.smithy:smithy-openapi:0.9.7&quot; is
required in order for smithy-build to map the &quot;openapi&quot; plugin name to the
correct Java library implementation.</p>
</div>
<div class="section" id="openapi-configuration-settings">
<h3>OpenAPI configuration settings<a class="headerlink" href="#openapi-configuration-settings" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">openapi</span></code> plugin is highly configurable to support different OpenAPI
tools and vendors.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You typically only need to configure the <code class="docutils literal notranslate"><span class="pre">service</span></code> and
<code class="docutils literal notranslate"><span class="pre">protocol</span></code> settings to create a valid OpenAPI specification.</p>
</div>
<p>The following key-value pairs are supported:</p>
<dl class="docutils">
<dt>service (string)</dt>
<dd><strong>Required</strong>. The Smithy service <a class="reference internal" href="../spec/core.html#shape-id"><span class="std std-ref">shape ID</span></a> to convert.</dd>
<dt>protocol (string)</dt>
<dd><p class="first">The protocol name to use when converting Smithy to OpenAPI (for example,
<code class="docutils literal notranslate"><span class="pre">aws.rest-json-1.1</span></code>.</p>
<p class="last">Smithy will try to match the provided protocol name with an implementation
of <code class="docutils literal notranslate"><span class="pre">software.amazon.smithy.openapi.fromsmithy.OpenApiProtocol</span></code>
registered with a service provider implementation of
<code class="docutils literal notranslate"><span class="pre">software.amazon.smithy.openapi.fromsmithy.CoreExtension</span></code>.</p>
</dd>
<dt>openapi.tags (boolean)</dt>
<dd>Whether or not to include Smithy <a class="reference internal" href="../spec/core.html#tags-trait"><span class="std std-ref">tags</span></a> in the result.</dd>
<dt>openapi.supportedTags ([string])</dt>
<dd><p class="first">Limits the exported <code class="docutils literal notranslate"><span class="pre">openapi.tags</span></code> to a specific set of tags. The value
must be a list of strings. This property requires that <code class="docutils literal notranslate"><span class="pre">openapi.tags</span></code>
is set to <code class="docutils literal notranslate"><span class="pre">true</span></code> in order to have an effect.</p>
<div class="last highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;plugins&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;openapi&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.example#Weather&quot;</span><span class="p">,</span>
            <span class="nt">&quot;openapi.tags&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;openapi.supportedTags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>openapi.defaultBlobFormat (string)</dt>
<dd>Sets the default format property used when converting blob shapes in
Smithy to strings in OpenAPI. Defaults to &quot;byte&quot;, meaning Base64 encoded.</dd>
<dt>openapi.use.xml (boolean)</dt>
<dd>Enables converting Smithy XML traits to OpenAPI XML properties. (this
feature is not yet implemented).</dd>
<dt>openapi.keepUnusedComponents (boolean)</dt>
<dd>Set to <code class="docutils literal notranslate"><span class="pre">true</span></code> to prevent unused components from being removed from the
created specification.</dd>
<dt>openapi.aws.jsonContentType (string)</dt>
<dd>Sets the media-type to associate with the JSON payload of <code class="docutils literal notranslate"><span class="pre">aws.json-*</span></code>
and <code class="docutils literal notranslate"><span class="pre">aws.rest-json-*</span></code> protocols</dd>
<dt>openapi.forbidGreedyLabels (boolean)</dt>
<dd>Set to true to forbid greedy URI labels. By default, greedy labels will
appear as-is in the path generated for an operation. For example,
&quot;/{foo+}&quot;.</dd>
<dt>openapi.onHttpPrefixHeaders (string)</dt>
<dd><p class="first">Specifies what to do when the <a class="reference internal" href="../spec/http.html#httpprefixheaders-trait"><span class="std std-ref">httpPrefixHeaders trait</span></a> is found in
a model. OpenAPI does not support <code class="docutils literal notranslate"><span class="pre">httpPrefixHeaders</span></code>. By default, the
conversion will fail when this trait is encountered, but this behavior
can be customized using the following values for the <code class="docutils literal notranslate"><span class="pre">openapi.onHttpPrefixHeaders</span></code>
setting:</p>
<ul class="simple">
<li>FAIL: The default setting that causes the build to fail.</li>
<li>WARN: The header is omitted from the OpenAPI model and a warning is logged.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Additional values may be supported by other mappers or protocols.</p>
</div>
<div class="last highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;plugins&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;openapi&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.example#Weather&quot;</span><span class="p">,</span>
            <span class="nt">&quot;openapi.onHttpPrefixHeaders&quot;</span><span class="p">:</span> <span class="s2">&quot;WARN&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>openapi.ignoreUnsupportedTrait (boolean)</dt>
<dd>Emits warnings rather than failing when unsupported traits like
<code class="docutils literal notranslate"><span class="pre">eventStream</span></code> are encountered.</dd>
<dt>openapi.disablePrimitiveInlining (boolean)</dt>
<dd><p class="first">Disables the automatic inlining of primitive <code class="docutils literal notranslate"><span class="pre">$ref</span></code> targets.</p>
<p>Inlining these primitive references helps to make the generated
OpenAPI models more idiomatic while leaving complex types as-is so that
they support recursive types.</p>
<p>A <em>primitive reference</em> is considered one of the following OpenAPI types:</p>
<ul class="simple">
<li>integer</li>
<li>number</li>
<li>boolean</li>
<li>string</li>
</ul>
<p class="last">A <em>primitive collection</em> is an array that has an &quot;items&quot;  property that
targets a primitive reference, or an object with no &quot;properties&quot; and an
&quot;additionalProperties&quot; reference that targets a primitive type.</p>
</dd>
<dt>openapi.substitutions (<code class="docutils literal notranslate"><span class="pre">Map&lt;String,</span> <span class="pre">any&gt;</span></code>)</dt>
<dd><p class="first">Defines a map of strings to any JSON value to find and replace in the
generated OpenAPI model.</p>
<p>This allows for placeholders to appear in the value of Smithy traits that
can be converted at build-time to an appropriate value.</p>
<p>String values are replaced if the string in its entirety matches
one of the keys provided in the <code class="docutils literal notranslate"><span class="pre">openapi.substitutions</span></code> map. The
corresponding value is then substituted for the string-- this could even
result in a string changing into an object, array, etc.</p>
<p>The following example will find all strings with a value of &quot;REPLACE_ME&quot;
and replace the string with an array value of
<code class="docutils literal notranslate"><span class="pre">[&quot;this</span> <span class="pre">is</span> <span class="pre">a&quot;,</span> <span class="pre">&quot;</span> <span class="pre">replacement&quot;]</span></code> and replace all strings with a value
of <code class="docutils literal notranslate"><span class="pre">ANOTHER_REPLACEMENT</span></code> with <code class="docutils literal notranslate"><span class="pre">Hello!!!</span></code>:</p>
<div class="last highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;plugins&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;openapi&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;smithy.example#Weather&quot;</span><span class="p">,</span>
            <span class="nt">&quot;openapi.substitutions&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;REPLACE_ME&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;this is a&quot;</span><span class="p">,</span> <span class="s2">&quot; replacement&quot;</span><span class="p">],</span>
                <span class="nt">&quot;ANOTHER_REPLACEMENT&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello!!!&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="json-schema-configuration-settings">
<h3>JSON schema configuration settings<a class="headerlink" href="#json-schema-configuration-settings" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>stripNamespaces (boolean)</dt>
<dd>Strips Smithy namespaces from the converted shape ID that is generated
in the definitions map of a JSON Schema document for a shape. This
requires that shape names across all namespaces are unique.</dd>
<dt>includePrivateShapes (boolean)</dt>
<dd>Includes shapes marked with the <a class="reference internal" href="../spec/core.html#private-trait"><span class="std std-ref">private trait</span></a>.</dd>
<dt>useJsonName (boolean)</dt>
<dd><p class="first">Uses the value of the <a class="reference internal" href="../spec/core.html#jsonname-trait"><span class="std std-ref">jsonName trait</span></a> when creating JSON schema
properties for structure and union shapes.</p>
<p class="last">TODO: This is enabled automatically with AWS protocols?</p>
</dd>
<dt>defaultTimestampFormat (string)</dt>
<dd>Sets the assumed <a class="reference internal" href="../spec/core.html#timestampformat-trait"><span class="std std-ref">timestampFormat trait</span></a> value for timestamps with
no explicit timestampFormat trait. The provided value is expected to be
a string. Defaults to &quot;date-time&quot; if not set. Can be set to &quot;date-time&quot;,
&quot;epoch-seconds&quot;, or &quot;http-date&quot;.</dd>
<dt>unionStrategy (string)</dt>
<dd><p class="first">Configures how Smithy union shapes are converted to JSON Schema.</p>
<p>This property must be a string set to one of the following values:</p>
<ul class="last simple">
<li>oneOf: Converts to a schema that uses &quot;oneOf&quot;. This is the
default setting used if not configured.</li>
<li>object: Converts to an empty object &quot;{}&quot;.</li>
<li>structure: Converts to an object with properties just like a
structure.</li>
</ul>
</dd>
<dt>schemaDocumentExtensions (<code class="docutils literal notranslate"><span class="pre">Map&lt;String,</span> <span class="pre">any&gt;</span></code>)</dt>
<dd>Adds custom top-level key-value pairs to the created OpenAPI specification.</dd>
</dl>
</div>
<div class="section" id="amazon-api-gateway-extensions">
<h3>Amazon API Gateway extensions<a class="headerlink" href="#amazon-api-gateway-extensions" title="Permalink to this headline">¶</a></h3>
<p>Smithy models can be converted to OpenAPI specifications that contain
<a class="reference external" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-swagger-extensions.html">Amazon API Gateway extensions</a> for defining things like integrations. These
API Gateway extensions are automatically picked up by Smithy by adding a
dependency on <code class="docutils literal notranslate"><span class="pre">software.amazon.smithy:smithy-aws-apigateway-openapi</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="apigateway-build-gradle">
<div class="code-block-caption"><span class="caption-text">build.gradle.kts</span><a class="headerlink" href="#apigateway-build-gradle" title="Permalink to this code">¶</a></div>
<div class="highlight-kotlin notranslate"><div class="highlight"><pre><span></span><span class="n">buildscript</span> <span class="p">{</span>
    <span class="n">dependencies</span> <span class="p">{</span>
        <span class="n">classpath</span><span class="p">(</span><span class="s">&quot;software.amazon.smithy:smithy-aws-apigateway-openapi:0.9.7&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="binary-types">
<h4>Binary types<a class="headerlink" href="#binary-types" title="Permalink to this headline">¶</a></h4>
<p>The list of binary media types used by an API need to be specified for
API Gateway in a top-level extension named <a class="reference external" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-swagger-extensions-binary-media-types.html">x-amazon-apigateway-binary-media-types</a>.
Smithy will automatically detect every media type used in a service by
collecting all of the <a class="reference internal" href="../spec/core.html#mediatype-trait"><span class="std std-ref">mediaType trait</span></a> values for all members marked
with <a class="reference internal" href="../spec/http.html#httppayload-trait"><span class="std std-ref">httpPayload trait</span></a>.</p>
</div>
<div class="section" id="request-validators">
<span id="apigateway-request-validators"></span><h4>Request validators<a class="headerlink" href="#request-validators" title="Permalink to this headline">¶</a></h4>
<p>Amazon API Gateway can perform request validation before forwarding a request
to an integration. You can opt-in to this feature using the
<code class="docutils literal notranslate"><span class="pre">aws.apigateway#requestValidator</span></code> trait.</p>
<p>Smithy will populate the value of the <a class="reference external" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-swagger-extensions-request-validators.html">x-amazon-apigateway-request-validators</a>
and <a class="reference external" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-swagger-extensions-request-validator.html">x-amazon-apigateway-request-validator</a> OpenAPI extensions using the
<code class="docutils literal notranslate"><span class="pre">aws.apigateway#requestValidator</span></code> traits found in a service. The
<code class="docutils literal notranslate"><span class="pre">aws.apigateway#requestValidator</span></code> trait can be applied to a service to
enable a specific kind of request validation on all operations within a
service. It can also be applied to an operation to set a specific validator
for the operation.</p>
<p>Smithy defines the following canned request validators:</p>
<dl class="docutils">
<dt>full</dt>
<dd><p class="first">Creates a request validator configured as</p>
<div class="last highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;validateRequestBody&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;validateRequestParameters&quot;</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>params-only</dt>
<dd><p class="first">Creates a request validator configured as</p>
<div class="last highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;validateRequestBody&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;validateRequestParameters&quot;</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt>body-only</dt>
<dd><p class="first">Creates a request validator configured as</p>
<div class="last highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;validateRequestBody&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;validateRequestParameters&quot;</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
<p>Smithy will gather all of the utilized request validators and add their
declarations in a top-level <code class="docutils literal notranslate"><span class="pre">x-amazon-apigateway-request-validators</span></code>
OpenAPI extension.</p>
</div>
<div class="section" id="integrations">
<span id="apigateway-integrations"></span><h4>Integrations<a class="headerlink" href="#integrations" title="Permalink to this headline">¶</a></h4>
<p>Smithy models can specify the backend integration configuration that
Amazon API Gateway uses to for an operation.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">aws.apigateway#integration</span></code> trait defines an API Gateway integration
that calls an actual backend.</li>
<li><code class="docutils literal notranslate"><span class="pre">aws.apigateway#mockIntegration</span></code> defines an API Gateway mock integration
that doesn't call a backend.</li>
</ul>
<p>If the trait is applied to a service shape, then all operations in the service
use the integration. If the trait is defined on a resource shape, then all
operations of the resource and all child resources use the integration. If
the trait is applied to an operation, then the operation uses a specific
integration that overrides any integration inherited from a resource or
service.</p>
</div>
<div class="section" id="cors-functionality">
<h4>CORS functionality<a class="headerlink" href="#cors-functionality" title="Permalink to this headline">¶</a></h4>
<p>TODO</p>
</div>
<div class="section" id="security-schemes">
<h4>Security schemes<a class="headerlink" href="#security-schemes" title="Permalink to this headline">¶</a></h4>
<p>TODO</p>
</div>
<div class="section" id="aws-cloudformation-substitutions">
<h4>AWS CloudFormation substitutions<a class="headerlink" href="#aws-cloudformation-substitutions" title="Permalink to this headline">¶</a></h4>
<p>OpenAPI specifications used with Amazon API Gateway are commonly deployed
through AWS CloudFormation. Values within an OpenAPI specification for things
like the region a service is deployed and resources used within the service
are often unknown until deployment-time. CloudFormation offers the ability
to use <a class="reference external" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference.html">intrinsic functions</a> in a JSON document to resolve, find, and
replace this unknown data at deployment-time.</p>
<p>When the <code class="docutils literal notranslate"><span class="pre">software.amazon.smithy:smithy-aws-apigateway-openapi</span></code> library
is loaded on the classpath, Smithy will treat specific, well-known parts
of an OpenAPI specification as an <a class="reference external" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-sub.html">Fn::Sub</a>. This allows Smithy models
to refer to variables that aren't available until a stack is created
using the format of <code class="docutils literal notranslate"><span class="pre">${x}</span></code> where &quot;x&quot; is the variable name.</p>
<p>Smithy will automatically wrap the following locations of an OpenAPI
specification in an <code class="docutils literal notranslate"><span class="pre">Fn::Sub</span></code> if the value contained in the location
uses the <code class="docutils literal notranslate"><span class="pre">Fn::Sub</span></code> variable syntax (<code class="docutils literal notranslate"><span class="pre">*</span></code> means any value):</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">components/securitySchemes/*/x-amazon-apigateway-authorizer/providerARNs/*</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">components/securitySchemes/*/x-amazon-apigateway-authorizer/authorizerCredentials</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">components/securitySchemes/*/x-amazon-apigateway-authorizer/authorizerUri</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">paths/*/*/x-amazon-apigateway-integration/connectionId</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">paths/*/*/x-amazon-apigateway-integration/credentials</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">paths/*/*/x-amazon-apigateway-integration/uri</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This functionality can be disabled by setting the <code class="docutils literal notranslate"><span class="pre">apigateway.disableCloudFormationSubstitution</span></code>
OpenAPI configuration property to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
</div>
</div>
<div class="section" id="amazon-cognito-user-pools">
<h4>Amazon Cognito user pools<a class="headerlink" href="#amazon-cognito-user-pools" title="Permalink to this headline">¶</a></h4>
<p>TODO</p>
</div>
<div class="section" id="other-traits-that-influence-api-gateway">
<h4>Other traits that influence API Gateway<a class="headerlink" href="#other-traits-that-influence-api-gateway" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">aws.api#service</span></code></dt>
<dd>TODO</dd>
<dt><code class="docutils literal notranslate"><span class="pre">protocols</span></code></dt>
<dd>TODO</dd>
<dt><code class="docutils literal notranslate"><span class="pre">aws.apigateway#apiKeySource</span></code></dt>
<dd>Specifies the source of the caller identifier that will be used to
throttle API methods that require a key. This trait is converted into
the <a class="reference external" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-swagger-extensions-api-key-source.html">x-amazon-apigateway-api-key-source</a> OpenAPI extension.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">aws.apigateway#authorizers</span></code></dt>
<dd><p class="first">Lambda authorizers to attach to the authentication schemes defined on
this service.</p>
<p class="last">TODO: add more information</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="converting-to-openapi-with-code">
<h2>Converting to OpenAPI with code<a class="headerlink" href="#converting-to-openapi-with-code" title="Permalink to this headline">¶</a></h2>
<p>Developers that need more advanced control over the Smithy to OpenAPI
conversion can use the <code class="docutils literal notranslate"><span class="pre">software.amazon.smithy:smithy-openapi</span></code> Java library
to perform the conversion.</p>
<p>First, you'll need to get a copy of the library. The following example
shows how to install <code class="docutils literal notranslate"><span class="pre">software.amazon.smithy:smithy-openapi</span></code> through Gradle:</p>
<div class="literal-block-wrapper docutils container" id="code-build-gradle">
<div class="code-block-caption"><span class="caption-text">build.gradle.kts</span><a class="headerlink" href="#code-build-gradle" title="Permalink to this code">¶</a></div>
<div class="highlight-kotlin notranslate"><div class="highlight"><pre><span></span><span class="n">buildscript</span> <span class="p">{</span>
    <span class="n">dependencies</span> <span class="p">{</span>
        <span class="n">classpath</span><span class="p">(</span><span class="s">&quot;software.amazon.smithy:smithy-openapi:0.9.7&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Next, you need to create and configure an <code class="docutils literal notranslate"><span class="pre">OpenApiConverter</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">software.amazon.smithy.model.shapes.ShapeId</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">software.amazon.smithy.openapi.fromsmithy.OpenApiConstants</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">software.amazon.smithy.openapi.fromsmithy.OpenApiConverter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">software.amazon.smithy.openapi.fromsmithy.model.OpenApi</span><span class="o">;</span>

<span class="n">OpenApiConverter</span> <span class="n">converter</span> <span class="o">=</span> <span class="n">OpenApiConverter</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>

<span class="c1">// Add any necessary settings...</span>
<span class="n">converter</span><span class="o">.</span><span class="na">putSetting</span><span class="o">(</span><span class="n">OpenApiConstants</span><span class="o">.</span><span class="na">PROTOCOL</span><span class="o">,</span> <span class="s">&quot;aws.rest-json-1.1&quot;</span><span class="o">);</span>

<span class="c1">// Create a shape ID that points to the service.</span>
<span class="n">ShapeId</span> <span class="n">serviceShapeId</span> <span class="o">=</span> <span class="n">ShapeId</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">&quot;smithy.example#Weather&quot;</span><span class="o">);</span>

<span class="n">OpenApi</span> <span class="n">result</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="n">myModel</span><span class="o">,</span> <span class="n">serviceShapeId</span><span class="o">);</span>
</pre></div>
</div>
<p>The conversion process is highly extensible through
<code class="docutils literal notranslate"><span class="pre">software.amazon.smithy.openapi.fromsmithy.CoreExtension</span></code>
<a class="reference external" href="https://docs.oracle.com/javase/tutorial/sound/SPI-intro.html">service providers</a>. See the Javadocs for more information.</p>
</div>
</div>




                    <section class="relations">

                        <a href="style-guide.html" title="previous chapter" class="previous-page clearfix hidden-xs">← Style Guide</a>

                    </section>

                </article><aside id="right-column" class="side-column hidden-sm">
                    <div class="column-body">
                        <section class="sidebar">
                            <ul>
<li><a class="reference internal" href="#">Converting Smithy to OpenAPI</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#differences-between-smithy-and-openapi">Differences between Smithy and OpenAPI</a><ul>
<li><a class="reference internal" href="#unsupported-features">Unsupported features</a></li>
</ul>
</li>
<li><a class="reference internal" href="#converting-to-openapi-with-smithy-build">Converting to OpenAPI with smithy-build</a><ul>
<li><a class="reference internal" href="#openapi-configuration-settings">OpenAPI configuration settings</a></li>
<li><a class="reference internal" href="#json-schema-configuration-settings">JSON schema configuration settings</a></li>
<li><a class="reference internal" href="#amazon-api-gateway-extensions">Amazon API Gateway extensions</a><ul>
<li><a class="reference internal" href="#binary-types">Binary types</a></li>
<li><a class="reference internal" href="#request-validators">Request validators</a></li>
<li><a class="reference internal" href="#integrations">Integrations</a></li>
<li><a class="reference internal" href="#cors-functionality">CORS functionality</a></li>
<li><a class="reference internal" href="#security-schemes">Security schemes</a></li>
<li><a class="reference internal" href="#aws-cloudformation-substitutions">AWS CloudFormation substitutions</a></li>
<li><a class="reference internal" href="#amazon-cognito-user-pools">Amazon Cognito user pools</a></li>
<li><a class="reference internal" href="#other-traits-that-influence-api-gateway">Other traits that influence API Gateway</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#converting-to-openapi-with-code">Converting to OpenAPI with code</a></li>
</ul>
</li>
</ul>

                        </section>
                    </div>
                </aside></div>
        </section>


<footer id="footer">
    <div class="width-wrapper">
        <div class="copyright">
            <p>©2019, Amazon Web Services, Inc or its affiliates. All rights reserved.</p>
        </div>
    </div>
</footer>
  </body>
</html>
